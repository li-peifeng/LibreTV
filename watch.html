<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="refresh" content="3; url=player.html">
    <title>正在跳转到播放器 - iSweeTv</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="css/watch.css">
    <style>
        /* 添加的进度条样式 - 不会覆盖现有样式 */
        .progress-container {
            width: 80%;
            max-width: 400px;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 25px auto;
            position: relative;
        }
        
        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #4cc9f0, #4361ee);
            border-radius: 4px;
            position: relative;
            transition: width 0.3s ease;
        }
        
        .progress-percentage {
            position: absolute;
            top: 10px;
            right: 0;
            font-size: 14px;
            font-weight: 500;
            color: #4cc9f0;
        }
        
        .time-counter {
            display: inline-block;
            margin-top: 10px;
            padding: 5px 12px;
            background: rgba(76, 201, 240, 0.15);
            border-radius: 50px;
            font-size: 14px;
            color: #4cc9f0;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="redirect-container">
        <div class="logo-container">
            <svg class="logo-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
            </svg>
            <h1 class="logo-text">iSweeTv</h1>
        </div>
        <div class="loading-animation"></div>
        <div class="redirect-message">正在加载播放器...</div>
        
        <!-- 添加的进度条元素 -->
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar">
                <span class="progress-percentage" id="progress-percentage">0%</span>
            </div>
        </div>
        <div class="time-counter" id="time-counter">正在准备</div>
        
        <div id="redirect-status">准备视频数据中，请稍候...</div>
        <p class="redirect-hint">如果页面没有自动跳转，请 <a href="player.html" id="manual-redirect">点击这里</a></p>
    </div>

    <script src="js/watch.js"></script>
    <script>
        // 确保在原始脚本加载后再添加进度条逻辑
        document.addEventListener('DOMContentLoaded', function() {
            // 安全地添加进度条功能
            addProgressBar();
        });
        
        function addProgressBar() {
            // 避免覆盖原始功能
            if (!document.getElementById('progress-bar')) return;
            
            const progressBar = document.getElementById('progress-bar');
            const progressPercentage = document.getElementById('progress-percentage');
            const timeCounter = document.getElementById('time-counter');
            const redirectStatus = document.getElementById('redirect-status');
            
            // 确保手动跳转链接仍然有效
            const manualRedirect = document.getElementById('manual-redirect');
            if (manualRedirect) {
                manualRedirect.addEventListener('click', function() {
                    // 在跳转前将进度设置为100%
                    progressBar.style.width = '100%';
                    progressPercentage.textContent = '100%';
                    timeCounter.textContent = '即将跳转';
                    redirectStatus.textContent = '加载完成，正在跳转...';
                });
            }
            
            // 进度更新消息
            const statusMessages = [
                "正在初始化播放器引擎...",
                "加载解码器...",
                "获取视频源...",
                "准备播放缓冲区...",
                "视频数据加载完成，即将跳转..."
            ];
            
            // 进度条更新的间隔时间（毫秒）
            const intervalTime = 50;
            const totalTime = 3000; // 3秒
            const steps = Math.ceil(totalTime / intervalTime);
            let step = 0;
            let progress = 0;
            
            // 更新进度条
            const progressInterval = setInterval(() => {
                step++;
                progress = Math.min(100, Math.floor((step / steps) * 100));
                
                // 更新进度条宽度
                progressBar.style.width = progress + '%';
                
                // 更新进度百分比文字
                progressPercentage.textContent = progress + '%';
                
                // 随着进度移动百分比显示位置
                progressPercentage.style.right = (100 - progress) + '%';
                
                // 在不同进度点更新状态信息
                if (progress < 20) {
                    redirectStatus.textContent = statusMessages[0];
                    timeCounter.textContent = "请稍候...";
                } else if (progress < 40) {
                    redirectStatus.textContent = statusMessages[1];
                    timeCounter.textContent = "正在准备...";
                } else if (progress < 60) {
                    redirectStatus.textContent = statusMessages[2];
                    timeCounter.textContent = "已完成一半";
                } else if (progress < 80) {
                    redirectStatus.textContent = statusMessages[3];
                    timeCounter.textContent = "即将完成...";
                } else if (progress < 95) {
                    redirectStatus.textContent = statusMessages[4];
                    timeCounter.textContent = "准备跳转";
                }
                
                // 进度完成时清除定时器
                if (progress >= 100) {
                    clearInterval(progressInterval);
                    redirectStatus.textContent = "加载完成，正在跳转...";
                }
            }, intervalTime);
        }
    </script>
</body>
</html>
